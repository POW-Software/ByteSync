<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:misc="clr-namespace:ByteSync.Views.Misc"
             xmlns:localizations="clr-namespace:ByteSync.Services.Localizations"
             xmlns:members="clr-namespace:ByteSync.ViewModels.Sessions.Members"
             mc:Ignorable="d"
             x:Class="ByteSync.Views.Sessions.Members.DataNodeSourcesView">

    <Design.DataContext>
        <members:DataNodeSourcesViewModel />
    </Design.DataContext>

    <StackPanel Orientation="Vertical">
        <!-- Ligne des boutons d'ajout -->
        <DockPanel IsVisible="{Binding IsLocalMachine}">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                <Button Command="{Binding AddDirectoryCommand}" HorizontalAlignment="Left" Margin="3"
                        IsEnabled="{Binding IsFileSystemSelectionEnabled}"
                        BorderThickness="0" Background="Transparent">
                    <StackPanel Orientation="Horizontal" Margin="0">
                        <misc:Icon FontSize="20" Value="SolidFolderPlus" Foreground="{DynamicResource SystemBaseMediumHighColor}"
                                   Margin="0" VerticalAlignment="Center" />
                        <TextBlock Text="{localizations:Loc SessionMachine_AddDirectory}" Margin="6 0 0 0" VerticalAlignment="Center" FontWeight="Bold"
                                   FontSize="12" />
                    </StackPanel>
                </Button>

                <!-- Fichiers (masqué si nécessaire) -->
                <Button Command="{Binding AddFileCommand}" HorizontalAlignment="Left" Margin="3"
                        IsEnabled="{Binding IsFileSystemSelectionEnabled}"
                        BorderThickness="0" Background="Transparent">
                    <StackPanel Orientation="Horizontal">
                        <misc:Icon FontSize="20" Value="SolidFilePlus" Foreground="{DynamicResource SystemBaseMediumHighColor}"
                                   Margin="0" VerticalAlignment="Center" />
                        <TextBlock Text="{localizations:Loc SessionMachine_AddFile}" Margin="6 0 0 0" VerticalAlignment="Center" FontWeight="Bold"
                                   FontSize="12" />
                    </StackPanel>
                </Button>

                <Label FontWeight="Bold" Content="{localizations:Loc SessionMachine_NoDataSelected}" Margin="12 0 0 2 "
                       IsVisible="{Binding !DataSources.Count}"
                       VerticalAlignment="Center" />
            </StackPanel>
        </DockPanel>

        <!-- Grille des sources -->
        <DataGrid AutoGenerateColumns="False" Margin="6" ItemsSource="{Binding DataSources}" Classes="NoHeaders"
                  IsReadOnly="True" x:Name="TheGrid" IsEnabled="{Binding IsFileSystemSelectionEnabled}"
                  HeadersVisibility="None" Foreground="{DynamicResource SystemBaseHighColor}">
            <DataGrid.Columns>
                <DataGridTextColumn Binding="{Binding Code}" Header="Code" Width="Auto" FontSize="14" />
                <DataGridTextColumn Binding="{Binding ElementType}" Header="Type" Width="Auto" FontSize="14" />
                <DataGridTemplateColumn Header="Path" Width="*" CanUserResize="True">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel VerticalAlignment="Center">
                                <StackPanel IsVisible="{Binding DataContext.IsLocalMachine, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}">
                                    <Button Classes="LinkButtonLight" Command="{Binding OpenPathCommand}">
                                        <TextBlock Text="{Binding Path}" FontSize="14" Margin="3" />
                                        <ToolTip.Tip>
                                            <StackPanel Orientation="Vertical">
                                                <TextBlock Text="{Binding Path}" FontSize="14" />
                                            </StackPanel>
                                        </ToolTip.Tip>
                                    </Button>
                                </StackPanel>
                                <StackPanel IsVisible="{Binding !DataContext.IsLocalMachine, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}">
                                    <TextBlock Text="{Binding Path}" FontSize="14" Margin="3" />
                                    <ToolTip.Tip>
                                        <TextBlock Text="{Binding Path}" FontSize="14" />
                                    </ToolTip.Tip>
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Width="34" IsVisible="{Binding IsLocalMachine}">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Classes="GenericButton"
                                    Command="{Binding DataContext.RemoveDataSourceCommand, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                                    CommandParameter="{Binding}"
                                    Width="32" BorderThickness="0">
                                <StackPanel>
                                    <misc:Icon FontSize="16" Value="RegularTrash" />
                                </StackPanel>
                            </Button>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </StackPanel>
</UserControl> 